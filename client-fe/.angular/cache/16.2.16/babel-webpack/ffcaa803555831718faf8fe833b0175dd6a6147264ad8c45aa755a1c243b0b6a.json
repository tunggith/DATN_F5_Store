{"ast":null,"code":"import { FormControl, FormGroup, Validators } from \"@angular/forms\";\nimport { forkJoin } from \"rxjs\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/service/notification.service\";\nimport * as i3 from \"src/app/service/authentication.service\";\nimport * as i4 from \"src/app/service/cart.service\";\nimport * as i5 from \"src/app/service/product.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nfunction LoginComponent_i_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"i\", 22);\n  }\n}\nexport class LoginComponent {\n  // constructor, ngOn\n  constructor(router, notifService, authenticationService, cartService, productService) {\n    this.router = router;\n    this.notifService = notifService;\n    this.authenticationService = authenticationService;\n    this.cartService = cartService;\n    this.productService = productService;\n    this.isPassInputHidden = true;\n  }\n  ngOnInit() {\n    this.checkLogin();\n    this.initFormLogin();\n  }\n  // public functions\n  // 1\n  togglePasswordInput() {\n    this.isPassInputHidden = !this.isPassInputHidden;\n  }\n  // 2\n  login() {\n    if (this.loginForm.get(\"phone\").hasError(\"required\") || this.loginForm.get(\"password\").hasError(\"required\")) {\n      this.notifService.error(\"Vui lòng điền đầy đủ thông tin!\");\n      return;\n    }\n    if (this.loginForm.get(\"phone\").hasError(\"pattern\")) {\n      this.notifService.error(\"Số điện thoại không hợp lệ!\");\n      return;\n    }\n    this.authenticationService.login(this.loginForm.value).subscribe({\n      // - login succeed => lấy token từ server, lưu token và object: customer vào localStorage\n      next: response => {\n        const token = response.headers.get(\"Jwt-Token\");\n        const loggedCust = response.body;\n        this.notifService.success(\"Đăng nhập thành công!\");\n        this.authenticationService.updateIsLoggedInSubj(true);\n        this.authenticationService.updateLoggedCust(response.body);\n        this.authenticationService.saveTokenToStorage(token);\n        this.authenticationService.saveCustomerToStorage(loggedCust);\n        // lấy lại danh sách cart-item\n        this.cartService.getCartItemsOfLoggedCustomer(loggedCust.id).subscribe({\n          next: newCartItems => {\n            // sau khi đã lấy hết cart-item, ta vẫn phải gán sp cho spct của từng cart-item\n            let getProdObservables = [];\n            for (let item of newCartItems) {\n              getProdObservables.push(this.productService.getProductByProductDetails(item.spct.id));\n            }\n            if (getProdObservables.length > 0) {\n              forkJoin(getProdObservables).subscribe({\n                next: products => {\n                  products.forEach((product, index) => {\n                    newCartItems[index].spct.sanPham = product;\n                    if (index === newCartItems.length - 1) {\n                      this.cartService.updateCartItemsOfLoggedUser(newCartItems);\n                      this.cartService.updateCartItemsQuantityOfLoggedUser(newCartItems.length);\n                      this.router.navigate([\"/\"]);\n                    }\n                  });\n                }\n              });\n            } else {\n              this.router.navigate([\"/\"]);\n            }\n          }\n        });\n      },\n      error: errRes => {\n        if (errRes.error.message === \"Bad credentials\") {\n          this.notifService.error(\"Số điện thoại hoặc mật khẩu của bạn không đúng hoặc chưa tồn tại trong hệ thống!\");\n        } else if (errRes.error.message === \"User is disabled\") {\n          this.notifService.error(\"Tài khoản của bạn đã bị khóa!\");\n        }\n      }\n    });\n  }\n  // private functions\n  // 1\n  checkLogin() {\n    if (this.authenticationService.isLoggedIn()) {\n      this.notifService.warning(\"Bạn cần đăng xuất để đến trang đăng nhập!\");\n      this.router.navigate([\"/\"]);\n    }\n  }\n  // 2\n  initFormLogin() {\n    this.loginForm = new FormGroup({\n      phone: new FormControl(\"0807760922\", [Validators.required, Validators.pattern(\"^(0[1-9][0-9]{8})$\")]),\n      password: new FormControl(\"A1234567\", [Validators.required])\n    });\n  }\n  static #_ = this.ɵfac = function LoginComponent_Factory(t) {\n    return new (t || LoginComponent)(i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.NotificationService), i0.ɵɵdirectiveInject(i3.AuthenticationService), i0.ɵɵdirectiveInject(i4.CartService), i0.ɵɵdirectiveInject(i5.ProductService));\n  };\n  static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: LoginComponent,\n    selectors: [[\"app-login\"]],\n    decls: 40,\n    vars: 3,\n    consts: [[2, \"margin-bottom\", \"120px\"], [1, \"px-4\", \"py-5\", \"px-md-5\", \"text-center\", \"text-lg-start\"], [1, \"container\"], [1, \"row\", \"gx-lg-5\", \"align-items-center\"], [1, \"col-lg-6\", \"mb-5\", \"mb-lg-0\"], [1, \"my-5\", \"display-3\", \"fw-bold\", \"ls-tight\"], [2, \"color\", \"#ffc107\"], [2, \"color\", \"hsl(217, 10%, 50.8%)\"], [1, \"form-container\"], [1, \"title\"], [1, \"form-horizontal\", 3, \"formGroup\"], [\"placeholder\", \"S\\u1ED1 \\u0111i\\u1EC7n tho\\u1EA1i\", \"type\", \"text\", \"formControlName\", \"phone\", 1, \"form-control\"], [1, \"mt-3\", \"mb-3\"], [\"placeholder\", \"M\\u1EADt kh\\u1EA9u\", \"formControlName\", \"password\", 1, \"form-control\", 3, \"type\"], [1, \"check-terms\"], [\"type\", \"checkbox\", 1, \"checkbox\", 3, \"click\"], [1, \"check-label\"], [1, \"signin-link\"], [\"routerLink\", \"/sign-up\"], [\"routerLink\", \"/forget-password\"], [\"type\", \"submit\", 1, \"btn\", \"signup\", 3, \"click\"], [\"class\", \"fa-solid fa-spin fa-spinner\", 4, \"ngIf\"], [1, \"fa-solid\", \"fa-spin\", \"fa-spinner\"]],\n    template: function LoginComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"section\", 0)(1, \"div\", 1)(2, \"div\", 2)(3, \"div\", 3)(4, \"div\", 4)(5, \"h1\", 5);\n        i0.ɵɵtext(6, \" Bee Shirt \");\n        i0.ɵɵelement(7, \"br\");\n        i0.ɵɵelementStart(8, \"span\", 6);\n        i0.ɵɵtext(9, \"\\u0110\\u1EB9p trong t\\u1EEBng th\\u01B0\\u1EDBc v\\u1EA3i\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(10, \"p\", 7);\n        i0.ɵɵtext(11, \" Bee Shirt \\u0111ang t\\u1EA1o ra nh\\u1EEFng b\\u1ED9 trang ph\\u1EE5c s\\u1EA3n xu\\u1EA5t trong n\\u01B0\\u1EDBc ho\\u00E0n to\\u00E0n c\\u00F3 th\\u1EC3 s\\u00E1nh ngang v\\u1EDBi c\\u00E1c th\\u01B0\\u01A1ng hi\\u1EC7u th\\u1EDDi trang nam \\u0111\\u1EBFn t\\u1EEB n\\u01B0\\u1EDBc ngo\\u00E0i v\\u1EC1 ki\\u1EC3u d\\u00E1ng, ch\\u1EA5t l\\u01B0\\u1EE3ng l\\u1EABn phong c\\u00E1ch th\\u1EDDi trang.\\u201D - CEO Bee Shirt \");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(12, \"div\", 4)(13, \"div\", 8)(14, \"h3\", 9);\n        i0.ɵɵtext(15, \"\\u0110\\u0103ng Nh\\u1EADp\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(16, \"form\", 10)(17, \"div\")(18, \"label\");\n        i0.ɵɵtext(19, \"T\\u00E0i Kho\\u1EA3n\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(20, \"input\", 11);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(21, \"div\", 12)(22, \"label\");\n        i0.ɵɵtext(23, \"M\\u1EADt Kh\\u1EA9u\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(24, \"input\", 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(25, \"div\", 14)(26, \"input\", 15);\n        i0.ɵɵlistener(\"click\", function LoginComponent_Template_input_click_26_listener() {\n          return ctx.togglePasswordInput();\n        });\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(27, \"span\", 16);\n        i0.ɵɵtext(28, \"Hi\\u1EC7n m\\u1EADt kh\\u1EA9u\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(29, \"span\", 17);\n        i0.ɵɵtext(30, \"B\\u1EA1n ch\\u01B0a c\\u00F3 t\\u00E0i kho\\u1EA3n? \");\n        i0.ɵɵelementStart(31, \"a\", 18);\n        i0.ɵɵtext(32, \"\\u0110\\u0103ng k\\u00FD\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(33, \"span\", 17);\n        i0.ɵɵtext(34, \"B\\u1EA1n qu\\u00EAn m\\u1EADt kh\\u1EA9u? \");\n        i0.ɵɵelementStart(35, \"a\", 19);\n        i0.ɵɵtext(36, \"Qu\\u00EAn m\\u1EADt kh\\u1EA9u?\");\n        i0.ɵɵelementEnd()();\n        i0.ɵɵelementStart(37, \"button\", 20);\n        i0.ɵɵlistener(\"click\", function LoginComponent_Template_button_click_37_listener() {\n          return ctx.login();\n        });\n        i0.ɵɵtext(38, \" \\u0110\\u0103ng Nh\\u1EADp \");\n        i0.ɵɵtemplate(39, LoginComponent_i_39_Template, 1, 0, \"i\", 21);\n        i0.ɵɵelementEnd()()()()()()()();\n      }\n      if (rf & 2) {\n        i0.ɵɵadvance(16);\n        i0.ɵɵproperty(\"formGroup\", ctx.loginForm);\n        i0.ɵɵadvance(8);\n        i0.ɵɵproperty(\"type\", ctx.isPassInputHidden ? \"password\" : \"text\");\n        i0.ɵɵadvance(15);\n        i0.ɵɵproperty(\"ngIf\", ctx.isLoading);\n      }\n    },\n    dependencies: [i6.NgIf, i7.ɵNgNoValidate, i7.DefaultValueAccessor, i7.NgControlStatus, i7.NgControlStatusGroup, i7.FormGroupDirective, i7.FormControlName, i1.RouterLink],\n    styles: [\".wrapperLogin[_ngcontent-%COMP%] {\\n  height: 80%;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%] {\\n  color: #000;\\n  font-size: 25px;\\n  font-weight: 600;\\n  text-transform: capitalize;\\n  margin: 0 0 25px;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]:after {\\n  content: \\\"\\\";\\n  background-color: #00a9ef;\\n  height: 3px;\\n  width: 60px;\\n  margin: 10px 0 0;\\n  display: block;\\n  clear: both;\\n}\\n\\n.form-container[_ngcontent-%COMP%] {\\n  background-color: #fff;\\n  font-family: \\\"Titillium Web\\\", sans-serif;\\n  font-size: 0;\\n  padding: 30px;\\n  border-radius: 20px;\\n  box-shadow: 0 0 25px -15px rgba(0, 0, 0, 0.3);\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%] {\\n  font-size: 0;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%] {\\n  color: #333;\\n  width: 50%;\\n  padding: 0 8px;\\n  margin: 0 0 15px;\\n  display: inline-block;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%] {\\n  font-size: 17px;\\n  font-weight: 600;\\n}\\n.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]   .check-terms[_ngcontent-%COMP%] {\\n  padding: 0 8px;\\n  margin: 0 0 25px;\\n  display: flex;\\n  align-items: center;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]   .form-control[_ngcontent-%COMP%] {\\n  color: #888;\\n  background: #fff;\\n  font-weight: 400;\\n  letter-spacing: 1px;\\n  height: 40px;\\n  padding: 6px 12px;\\n  border-radius: 10px;\\n  border: 2px solid #e7e7e7;\\n  box-shadow: none;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .signin-link[_ngcontent-%COMP%] {\\n  color: #333;\\n  font-size: 14px;\\n  width: calc(100% - 190px);\\n  margin-right: 30px;\\n  display: inline-block;\\n  vertical-align: top;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .signin-link[_ngcontent-%COMP%]   a[_ngcontent-%COMP%] {\\n  color: #00a9ef;\\n  font-weight: 600;\\n  transition: all 0.3s ease 0s;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]   .signup[_ngcontent-%COMP%] {\\n  color: #fff;\\n  background: #000000;\\n  font-size: 15px;\\n  font-weight: 700;\\n  letter-spacing: 1px;\\n  width: 160px;\\n  padding: 8px 15px 9px;\\n  border-radius: 10px;\\n  transition: all 0.3s ease 0s;\\n}\\n\\n.form-container[_ngcontent-%COMP%]   .form-horizontal[_ngcontent-%COMP%]   .check-terms[_ngcontent-%COMP%]   .check-label[_ngcontent-%COMP%] {\\n  color: #333;\\n  font-size: 14px;\\n  font-weight: 500;\\n  vertical-align: top;\\n  display: inline-block;\\n  margin-left: 5px;\\n}\\n\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvY29tcG9uZW50cy9sb2ctaW4vbG9naW4uY29tcG9uZW50LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtFQUNFLFdBQVc7QUFDYjs7QUFFQTtFQUNFLFdBQVc7RUFDWCxlQUFlO0VBQ2YsZ0JBQWdCO0VBQ2hCLDBCQUEwQjtFQUMxQixnQkFBZ0I7QUFDbEI7O0FBRUE7RUFDRSxXQUFXO0VBQ1gseUJBQXlCO0VBQ3pCLFdBQVc7RUFDWCxXQUFXO0VBQ1gsZ0JBQWdCO0VBQ2hCLGNBQWM7RUFDZCxXQUFXO0FBQ2I7O0FBRUE7RUFDRSxzQkFBc0I7RUFDdEIsd0NBQXdDO0VBQ3hDLFlBQVk7RUFDWixhQUFhO0VBQ2IsbUJBQW1CO0VBQ25CLDZDQUE2QztBQUMvQzs7QUFFQTtFQUNFLFlBQVk7QUFDZDs7QUFFQTtFQUNFLFdBQVc7RUFDWCxVQUFVO0VBQ1YsY0FBYztFQUNkLGdCQUFnQjtFQUNoQixxQkFBcUI7QUFDdkI7O0FBRUE7RUFDRSxlQUFlO0VBQ2YsZ0JBQWdCO0FBQ2xCO0FBQ0E7RUFDRSxjQUFjO0VBQ2QsZ0JBQWdCO0VBQ2hCLGFBQWE7RUFDYixtQkFBbUI7QUFDckI7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsZ0JBQWdCO0VBQ2hCLGdCQUFnQjtFQUNoQixtQkFBbUI7RUFDbkIsWUFBWTtFQUNaLGlCQUFpQjtFQUNqQixtQkFBbUI7RUFDbkIseUJBQXlCO0VBQ3pCLGdCQUFnQjtBQUNsQjs7QUFFQTtFQUNFLFdBQVc7RUFDWCxlQUFlO0VBQ2YseUJBQXlCO0VBQ3pCLGtCQUFrQjtFQUNsQixxQkFBcUI7RUFDckIsbUJBQW1CO0FBQ3JCOztBQUVBO0VBQ0UsY0FBYztFQUNkLGdCQUFnQjtFQUNoQiw0QkFBNEI7QUFDOUI7O0FBRUE7RUFDRSxXQUFXO0VBQ1gsbUJBQW1CO0VBQ25CLGVBQWU7RUFDZixnQkFBZ0I7RUFDaEIsbUJBQW1CO0VBQ25CLFlBQVk7RUFDWixxQkFBcUI7RUFDckIsbUJBQW1CO0VBQ25CLDRCQUE0QjtBQUM5Qjs7QUFFQTtFQUNFLFdBQVc7RUFDWCxlQUFlO0VBQ2YsZ0JBQWdCO0VBQ2hCLG1CQUFtQjtFQUNuQixxQkFBcUI7RUFDckIsZ0JBQWdCO0FBQ2xCIiwic291cmNlc0NvbnRlbnQiOlsiLndyYXBwZXJMb2dpbiB7XHJcbiAgaGVpZ2h0OiA4MCU7XHJcbn1cclxuXHJcbi5mb3JtLWNvbnRhaW5lciAudGl0bGUge1xyXG4gIGNvbG9yOiAjMDAwO1xyXG4gIGZvbnQtc2l6ZTogMjVweDtcclxuICBmb250LXdlaWdodDogNjAwO1xyXG4gIHRleHQtdHJhbnNmb3JtOiBjYXBpdGFsaXplO1xyXG4gIG1hcmdpbjogMCAwIDI1cHg7XHJcbn1cclxuXHJcbi5mb3JtLWNvbnRhaW5lciAudGl0bGU6YWZ0ZXIge1xyXG4gIGNvbnRlbnQ6IFwiXCI7XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogIzAwYTllZjtcclxuICBoZWlnaHQ6IDNweDtcclxuICB3aWR0aDogNjBweDtcclxuICBtYXJnaW46IDEwcHggMCAwO1xyXG4gIGRpc3BsYXk6IGJsb2NrO1xyXG4gIGNsZWFyOiBib3RoO1xyXG59XHJcblxyXG4uZm9ybS1jb250YWluZXIge1xyXG4gIGJhY2tncm91bmQtY29sb3I6ICNmZmY7XHJcbiAgZm9udC1mYW1pbHk6IFwiVGl0aWxsaXVtIFdlYlwiLCBzYW5zLXNlcmlmO1xyXG4gIGZvbnQtc2l6ZTogMDtcclxuICBwYWRkaW5nOiAzMHB4O1xyXG4gIGJvcmRlci1yYWRpdXM6IDIwcHg7XHJcbiAgYm94LXNoYWRvdzogMCAwIDI1cHggLTE1cHggcmdiYSgwLCAwLCAwLCAwLjMpO1xyXG59XHJcblxyXG4uZm9ybS1jb250YWluZXIgLmZvcm0taG9yaXpvbnRhbCB7XHJcbiAgZm9udC1zaXplOiAwO1xyXG59XHJcblxyXG4uZm9ybS1jb250YWluZXIgLmZvcm0taG9yaXpvbnRhbCAuZm9ybS1ncm91cCB7XHJcbiAgY29sb3I6ICMzMzM7XHJcbiAgd2lkdGg6IDUwJTtcclxuICBwYWRkaW5nOiAwIDhweDtcclxuICBtYXJnaW46IDAgMCAxNXB4O1xyXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcclxufVxyXG5cclxuLmZvcm0tY29udGFpbmVyIC5mb3JtLWhvcml6b250YWwgLmZvcm0tZ3JvdXAgbGFiZWwge1xyXG4gIGZvbnQtc2l6ZTogMTdweDtcclxuICBmb250LXdlaWdodDogNjAwO1xyXG59XHJcbi5mb3JtLWNvbnRhaW5lciAuZm9ybS1ob3Jpem9udGFsIC5jaGVjay10ZXJtcyB7XHJcbiAgcGFkZGluZzogMCA4cHg7XHJcbiAgbWFyZ2luOiAwIDAgMjVweDtcclxuICBkaXNwbGF5OiBmbGV4O1xyXG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbn1cclxuXHJcbi5mb3JtLWNvbnRhaW5lciAuZm9ybS1ob3Jpem9udGFsIC5mb3JtLWNvbnRyb2wge1xyXG4gIGNvbG9yOiAjODg4O1xyXG4gIGJhY2tncm91bmQ6ICNmZmY7XHJcbiAgZm9udC13ZWlnaHQ6IDQwMDtcclxuICBsZXR0ZXItc3BhY2luZzogMXB4O1xyXG4gIGhlaWdodDogNDBweDtcclxuICBwYWRkaW5nOiA2cHggMTJweDtcclxuICBib3JkZXItcmFkaXVzOiAxMHB4O1xyXG4gIGJvcmRlcjogMnB4IHNvbGlkICNlN2U3ZTc7XHJcbiAgYm94LXNoYWRvdzogbm9uZTtcclxufVxyXG5cclxuLmZvcm0tY29udGFpbmVyIC5zaWduaW4tbGluayB7XHJcbiAgY29sb3I6ICMzMzM7XHJcbiAgZm9udC1zaXplOiAxNHB4O1xyXG4gIHdpZHRoOiBjYWxjKDEwMCUgLSAxOTBweCk7XHJcbiAgbWFyZ2luLXJpZ2h0OiAzMHB4O1xyXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcclxuICB2ZXJ0aWNhbC1hbGlnbjogdG9wO1xyXG59XHJcblxyXG4uZm9ybS1jb250YWluZXIgLnNpZ25pbi1saW5rIGEge1xyXG4gIGNvbG9yOiAjMDBhOWVmO1xyXG4gIGZvbnQtd2VpZ2h0OiA2MDA7XHJcbiAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZSAwcztcclxufVxyXG5cclxuLmZvcm0tY29udGFpbmVyIC5mb3JtLWhvcml6b250YWwgLnNpZ251cCB7XHJcbiAgY29sb3I6ICNmZmY7XHJcbiAgYmFja2dyb3VuZDogIzAwMDAwMDtcclxuICBmb250LXNpemU6IDE1cHg7XHJcbiAgZm9udC13ZWlnaHQ6IDcwMDtcclxuICBsZXR0ZXItc3BhY2luZzogMXB4O1xyXG4gIHdpZHRoOiAxNjBweDtcclxuICBwYWRkaW5nOiA4cHggMTVweCA5cHg7XHJcbiAgYm9yZGVyLXJhZGl1czogMTBweDtcclxuICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlIDBzO1xyXG59XHJcblxyXG4uZm9ybS1jb250YWluZXIgLmZvcm0taG9yaXpvbnRhbCAuY2hlY2stdGVybXMgLmNoZWNrLWxhYmVsIHtcclxuICBjb2xvcjogIzMzMztcclxuICBmb250LXNpemU6IDE0cHg7XHJcbiAgZm9udC13ZWlnaHQ6IDUwMDtcclxuICB2ZXJ0aWNhbC1hbGlnbjogdG9wO1xyXG4gIGRpc3BsYXk6IGlubGluZS1ibG9jaztcclxuICBtYXJnaW4tbGVmdDogNXB4O1xyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0= */\"]\n  });\n}","map":{"version":3,"names":["FormControl","FormGroup","Validators","forkJoin","i0","ɵɵelement","LoginComponent","constructor","router","notifService","authenticationService","cartService","productService","isPassInputHidden","ngOnInit","checkLogin","initFormLogin","togglePasswordInput","login","loginForm","get","hasError","error","value","subscribe","next","response","token","headers","loggedCust","body","success","updateIsLoggedInSubj","updateLoggedCust","saveTokenToStorage","saveCustomerToStorage","getCartItemsOfLoggedCustomer","id","newCartItems","getProdObservables","item","push","getProductByProductDetails","spct","length","products","forEach","product","index","sanPham","updateCartItemsOfLoggedUser","updateCartItemsQuantityOfLoggedUser","navigate","errRes","message","isLoggedIn","warning","phone","required","pattern","password","_","ɵɵdirectiveInject","i1","Router","i2","NotificationService","i3","AuthenticationService","i4","CartService","i5","ProductService","_2","selectors","decls","vars","consts","template","LoginComponent_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵlistener","LoginComponent_Template_input_click_26_listener","LoginComponent_Template_button_click_37_listener","ɵɵtemplate","LoginComponent_i_39_Template","ɵɵadvance","ɵɵproperty","isLoading"],"sources":["E:\\Du_An_Tot_Nghiep\\DATN_F5_Store\\client-fe\\src\\app\\components\\log-in\\login.component.ts","E:\\Du_An_Tot_Nghiep\\DATN_F5_Store\\client-fe\\src\\app\\components\\log-in\\login.component.html"],"sourcesContent":["import { HttpErrorResponse, HttpResponse } from \"@angular/common/http\";\r\nimport { Component } from \"@angular/core\";\r\nimport { FormControl, FormGroup, Validators } from \"@angular/forms\";\r\nimport { Router } from \"@angular/router\";\r\nimport { forkJoin } from \"rxjs\";\r\n\r\nimport { CartItem } from \"src/app/model/class/cart-item.class\";\r\nimport { Customer } from \"src/app/model/class/customer.class\";\r\nimport { SanPham } from \"src/app/model/class/san-pham.class\";\r\nimport { AuthenticationService } from \"src/app/service/authentication.service\";\r\nimport { CartService } from \"src/app/service/cart.service\";\r\nimport { NotificationService } from \"src/app/service/notification.service\";\r\nimport { ProductService } from \"src/app/service/product.service\";\r\nimport { TestService } from \"src/app/service/test.service\";\r\n\r\n@Component({\r\n  selector: \"app-login\",\r\n  templateUrl: \"./login.component.html\",\r\n  styleUrls: [\"./login.component.css\"],\r\n})\r\nexport class LoginComponent {\r\n  public isLoading: boolean;\r\n  public loginForm: FormGroup;\r\n  public isPassInputHidden = true;\r\n\r\n  // constructor, ngOn\r\n  constructor(\r\n    private router: Router,\r\n    private notifService: NotificationService,\r\n    private authenticationService: AuthenticationService,\r\n    private cartService: CartService,\r\n    private productService: ProductService\r\n  ) {}\r\n\r\n  ngOnInit(): void {\r\n    this.checkLogin();\r\n    this.initFormLogin();\r\n  }\r\n\r\n  // public functions\r\n  // 1\r\n  public togglePasswordInput(): void {\r\n    this.isPassInputHidden = !this.isPassInputHidden;\r\n  }\r\n\r\n  // 2\r\n  public login(): void {\r\n    if (\r\n      this.loginForm.get(\"phone\").hasError(\"required\") ||\r\n      this.loginForm.get(\"password\").hasError(\"required\")\r\n    ) {\r\n      this.notifService.error(\"Vui lòng điền đầy đủ thông tin!\");\r\n      return;\r\n    }\r\n\r\n    if (this.loginForm.get(\"phone\").hasError(\"pattern\")) {\r\n      this.notifService.error(\"Số điện thoại không hợp lệ!\");\r\n      return;\r\n    }\r\n\r\n    this.authenticationService.login(this.loginForm.value).subscribe({\r\n      // - login succeed => lấy token từ server, lưu token và object: customer vào localStorage\r\n      next: (response: HttpResponse<Customer>) => {\r\n        const token = response.headers.get(\"Jwt-Token\");\r\n        const loggedCust = response.body;\r\n\r\n        this.notifService.success(\"Đăng nhập thành công!\");\r\n        this.authenticationService.updateIsLoggedInSubj(true);\r\n        this.authenticationService.updateLoggedCust(response.body);\r\n\r\n        this.authenticationService.saveTokenToStorage(token);\r\n        this.authenticationService.saveCustomerToStorage(loggedCust);\r\n\r\n        // lấy lại danh sách cart-item\r\n        this.cartService.getCartItemsOfLoggedCustomer(loggedCust.id).subscribe({\r\n          next: (newCartItems: CartItem[]) => {\r\n            // sau khi đã lấy hết cart-item, ta vẫn phải gán sp cho spct của từng cart-item\r\n            let getProdObservables = [];\r\n            for (let item of newCartItems) {\r\n              getProdObservables.push(\r\n                this.productService.getProductByProductDetails(item.spct.id)\r\n              );\r\n            }\r\n\r\n            if (getProdObservables.length > 0) {\r\n              forkJoin(getProdObservables).subscribe({\r\n                next: (products: SanPham[]) => {\r\n                  products.forEach((product, index) => {\r\n                    newCartItems[index].spct.sanPham = product;\r\n                    if (index === newCartItems.length - 1) {\r\n                      this.cartService.updateCartItemsOfLoggedUser(\r\n                        newCartItems\r\n                      );\r\n                      this.cartService.updateCartItemsQuantityOfLoggedUser(\r\n                        newCartItems.length\r\n                      );\r\n                      this.router.navigate([\"/\"]);\r\n                    }\r\n                  });\r\n                },\r\n              });\r\n            } else {\r\n              this.router.navigate([\"/\"]);\r\n            }\r\n          },\r\n        });\r\n      },\r\n      error: (errRes: HttpErrorResponse) => {\r\n        if (errRes.error.message === \"Bad credentials\") {\r\n          this.notifService.error(\r\n            \"Số điện thoại hoặc mật khẩu của bạn không đúng hoặc chưa tồn tại trong hệ thống!\"\r\n          );\r\n        } else if (errRes.error.message === \"User is disabled\") {\r\n          this.notifService.error(\"Tài khoản của bạn đã bị khóa!\");\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  // private functions\r\n  // 1\r\n  private checkLogin(): void {\r\n    if (this.authenticationService.isLoggedIn()) {\r\n      this.notifService.warning(\"Bạn cần đăng xuất để đến trang đăng nhập!\");\r\n      this.router.navigate([\"/\"]);\r\n    }\r\n  }\r\n\r\n  // 2\r\n  private initFormLogin(): void {\r\n    this.loginForm = new FormGroup({\r\n      phone: new FormControl(\"0807760922\", [\r\n        Validators.required,\r\n        Validators.pattern(\"^(0[1-9][0-9]{8})$\"),\r\n      ]),\r\n      password: new FormControl(\"A1234567\", [Validators.required]),\r\n    });\r\n  }\r\n}\r\n","<section style=\"margin-bottom: 120px\">\r\n  <div class=\"px-4 py-5 px-md-5 text-center text-lg-start\">\r\n    <div class=\"container\">\r\n      <div class=\"row gx-lg-5 align-items-center\">\r\n        <div class=\"col-lg-6 mb-5 mb-lg-0\">\r\n          <h1 class=\"my-5 display-3 fw-bold ls-tight\">\r\n            Bee Shirt <br />\r\n            <span style=\"color: #ffc107\">Đẹp trong từng thước vải</span>\r\n          </h1>\r\n          <p style=\"color: hsl(217, 10%, 50.8%)\">\r\n            Bee Shirt đang tạo ra những bộ trang phục sản xuất trong nước hoàn\r\n            toàn có thể sánh ngang với các thương hiệu thời trang nam đến từ\r\n            nước ngoài về kiểu dáng, chất lượng lẫn phong cách thời trang.” -\r\n            CEO Bee Shirt\r\n          </p>\r\n        </div>\r\n\r\n        <div class=\"col-lg-6 mb-5 mb-lg-0\">\r\n          <div class=\"form-container\">\r\n            <h3 class=\"title\">Đăng Nhập</h3>\r\n            <form class=\"form-horizontal\" [formGroup]=\"loginForm\">\r\n              <div>\r\n                <label>Tài Khoản</label>\r\n                <input\r\n                  class=\"form-control\"\r\n                  placeholder=\"Số điện thoại\"\r\n                  type=\"text\"\r\n                  formControlName=\"phone\"\r\n                />\r\n              </div>\r\n\r\n              <div class=\"mt-3 mb-3\">\r\n                <label>Mật Khẩu</label>\r\n                <input\r\n                  class=\"form-control\"\r\n                  placeholder=\"Mật khẩu\"\r\n                  [type]=\"isPassInputHidden ? 'password' : 'text'\"\r\n                  formControlName=\"password\"\r\n                />\r\n              </div>\r\n\r\n              <div class=\"check-terms\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  class=\"checkbox\"\r\n                  (click)=\"togglePasswordInput()\"\r\n                />\r\n                <span class=\"check-label\">Hiện mật khẩu</span>\r\n              </div>\r\n              <span class=\"signin-link\"\r\n                >Bạn chưa có tài khoản?\r\n                <a routerLink=\"/sign-up\">Đăng ký</a></span\r\n              >\r\n              <span class=\"signin-link\"\r\n                >Bạn quên mật khẩu?\r\n                <a routerLink=\"/forget-password\">Quên mật khẩu?</a></span\r\n              >\r\n              <button class=\"btn signup\" type=\"submit\" (click)=\"login()\">\r\n                Đăng Nhập\r\n                <i *ngIf=\"isLoading\" class=\"fa-solid fa-spin fa-spinner\"></i>\r\n              </button>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</section>\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}