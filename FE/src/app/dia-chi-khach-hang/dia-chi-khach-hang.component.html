<div class="popup">
    <div class="content">
        <button class="close" (click)="close()"
            style="background: linear-gradient(135deg, #3a6f9e 0%, #4fb0d1 100%); color: #f0f0f0; border-radius: 8px; border: none; font-size: 24px; position: absolute; right: 10px; top: 5px; cursor: pointer; padding: 5px; display: flex; align-items: center; justify-content: center; transition: all 0.2s;">
            <i class="material-icons" style="color: #f0f0f0; transition: all 0.2s;">close</i>
        </button>

        <div style="box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); padding: 20px; border-radius: 8px;">
            <form [formGroup]="diaChiForm" (ngSubmit)="createDiaChi()">
                <div class="row">
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label class="form-label">Số nhà</label>
                            <input type="text" class="form-control" placeholder="  Nhập số nhà" formControlName="soNha" style="border: 1px solid #ccc; padding: 8px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div *ngIf="diaChiForm.get('soNha').invalid && diaChiForm.get('soNha').touched">
                                <small class="text-danger" *ngIf="diaChiForm.get('soNha').errors?.required">
                                    Vui lòng nhập số nhà
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label class="form-label">Đường</label>
                            <input type="text" class="form-control" placeholder="  Nhập đường" formControlName="duong" style="border: 1px solid #ccc; padding: 8px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div *ngIf="diaChiForm.get('duong').invalid && diaChiForm.get('duong').touched">
                                <small class="text-danger" *ngIf="diaChiForm.get('duong').errors?.required">
                                    Vui lòng nhập tên đường
                                </small>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <div>
                                <label for="" class="form-label">Tỉnh thành</label>
                                <select class="form-select" aria-label="Default select example"
                                    style="height: 40px;font-size: 15px;" formControlName="tinhThanh"
                                    (change)="onTinhThanhChange($event)">
                                    <option value="">Chọn tỉnh thành</option>
                                    <option *ngFor="let province of provinces" [value]="province.ProvinceID">
                                        {{ province.ProvinceName }}
                                    </option>
                                </select>
                                <div *ngIf="diaChiForm.get('tinhThanh').invalid && diaChiForm.get('tinhThanh').touched">
                                    <small class="text-danger" *ngIf="diaChiForm.get('tinhThanh').errors?.required">
                                        Vui lòng chọn tỉnh thành
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <div>
                                <label for="" class="form-label">Quận huyện</label>
                                <select class="form-select" aria-label="Default select example"
                                    style="height: 40px;font-size: 15px;" formControlName="quanHuyen"
                                    (change)="onQuanHuyenChange($event)" [disabled]="!diaChiForm.get('tinhThanh').value">
                                    <option value="">Chọn quận huyện</option>
                                    <option *ngFor="let district of districts" [value]="district.DistrictID">
                                        {{ district.DistrictName }}
                                    </option>
                                </select>
                                <div *ngIf="diaChiForm.get('quanHuyen').invalid && diaChiForm.get('quanHuyen').touched">
                                    <small class="text-danger" *ngIf="diaChiForm.get('quanHuyen').errors?.required">
                                        Vui lòng chọn quận huyện
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <div>
                                <label for="" class="form-label">Phường xã</label>
                                <select class="form-select" aria-label="Default select example"
                                    style="height: 40px;font-size: 15px;" formControlName="phuongXa"
                                    (change)="onPhuongXaChange($event)" [disabled]="!diaChiForm.get('quanHuyen').value">
                                    <option value="">Chọn phường xã</option>
                                    <option *ngFor="let ward of wards" [value]="ward.WardCode">
                                        {{ ward.WardName }}
                                    </option>
                                </select>
                                <div *ngIf="diaChiForm.get('phuongXa').invalid && diaChiForm.get('phuongXa').touched">
                                    <small class="text-danger" *ngIf="diaChiForm.get('phuongXa').errors?.required">
                                        Vui lòng chọn phường xã
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label class="form-label">Quốc gia</label>
                            <input type="text" class="form-control" placeholder="  Nhập quốc gia" formControlName="quocGia" style="border: 1px solid #ccc; padding: 8px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div *ngIf="diaChiForm.get('quocGia').invalid && diaChiForm.get('quocGia').touched">
                                <small class="text-danger" *ngIf="diaChiForm.get('quocGia').errors?.required">
                                    Vui lòng nhập quốc gia
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label class="form-label">Loại địa chỉ</label>
                            <div class="form-check" style="display: flex; align-items: center;">
                                <input class="form-check-radio" type="radio" id="loaiDiaChiNhaRieng" style="width: 20px; margin-right: 10px;"
                                    formControlName="loaiDiaChi" value="Nhà riêng" checked>
                                <label class="form-check-label" for="loaiDiaChiNhaRieng" style="margin-right: 20px;">Nhà
                                    riêng</label>
                            </div>
                            <div class="form-check" style="display: flex; align-items: center;">
                                <input class="form-check-radio" type="radio" id="loaiDiaChiCongTy" style="margin-right: 10px;"
                                    formControlName="loaiDiaChi" value="Công ty">
                                <label class="form-check-label" for="loaiDiaChiCongTy" style="margin-right: 20px;">Công
                                    ty</label>
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-4">
                        <div class="mb-3">
                            <label class="form-label">Trạng thái</label>
                            <div class="form-check">
                                <input class="form-check-radio" type="radio" value="Còn sử dụng" id="editConSuDung"
                                    formControlName="trangThai" checked>
                                <label class="form-check-label" for="editConSuDung">Còn sử
                                    dụng</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-radio" type="radio" value="Ngừng sử dụng" id="editKhongConSuDung"
                                    formControlName="trangThai">
                                <label class="form-check-label" style="margin-top: -10px;" for="editKhongConSuDung">Ngừng
                                    sử dụng</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6" style="text-align: end;">
                        <div class="button-action" >
                            <button type="submit" class="btn-submit" *ngIf="!idDiaChi" style="text-align: center; background: linear-gradient(135deg, #3a6f9e 0%, #4fb0d1 100%); color: #f0f0f0; border-radius: 8px;">
                                <i class="material-icons">add_location_alt</i>Thêm địa chỉ
                            </button>
                        </div>  
                        <div class="button-action" >
                            <button type="button" class="btn-submit" *ngIf="idDiaChi" 
                                (click)="updateDiaChi(); idDiaChi = null" style="text-align: center; background: linear-gradient(135deg, #3a6f9e 0%, #4fb0d1 100%); color: #f0f0f0; border-radius: 8px;">
                                <i class="material-icons">update</i>Cập nhật địa chỉ
                            </button>
                        </div>
                    </div>
                    <div class="col-sm-6">
                        <div class="button-action" >
                            <button type="button" class="btn-submit" (click)="resetForm(); idDiaChi = null"
                                style="text-align: center; background: linear-gradient(135deg, #3a6f9e 0%, #4fb0d1 100%); color: #f0f0f0; border-radius: 8px;">
                                <i class="material-icons">note</i>Làm mới
                            </button>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Table hiển thị dữ liệu khách hàng -->
        <div class="table-responsive">
            <table class="table table-striped">
                <thead class="text-primary">
                    <tr>
                        <th style="border: 1px solid #ddd;text-align: center;">STT</th>
                        <th style="border: 1px solid #ddd;text-align: center;">Số nhà</th>
                        <th style="border: 1px solid #ddd;">Đường</th>
                        <th style="border: 1px solid #ddd;">Tỉnh thành</th>
                        <th style="border: 1px solid #ddd;">Quận huyện</th>
                        <th style="border: 1px solid #ddd;">Phường xã</th>
                        <th style="border: 1px solid #ddd;">Quốc gia</th>
                        <th style="border: 1px solid #ddd;">Loại địa chỉ</th>
                        <th style="border: 1px solid #ddd;">Trạng thái</th>
                        <th style="border: 1px solid #ddd;">Thao tác</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let customerAddress of customersDiaChi; let i = index">
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;text-align: center;">{{ i + 1 }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;text-align: center;">{{ customerAddress.soNha }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;">{{ customerAddress.duong }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;">{{ customerAddress.tinhThanh }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;">{{ customerAddress.quanHuyen }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;">{{ customerAddress.phuongXa }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;">{{ customerAddress.quocGia }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;">{{ customerAddress.loaiDiaChi }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;">{{ customerAddress.trangThai }}</td>
                        <td style="border: 1px solid #ddd; overflow: hidden; text-overflow: ellipsis;text-align: center;">
                            <button (click)="diaChiDetail(customerAddress.id)" class="btn dark-blue" style="background: linear-gradient(135deg, #3a6f9e 0%, #4fb0d1 100%); color: #f0f0f0; border-radius: 8px;text-align: center;">
                                <i class="material-icons">edit</i>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="pagination" style="display: flex; justify-content: center; align-items: center;">
            <button (click)="changePage(page - 1)" [disabled]="page === 0" style="padding: 2px 5px; font-size: 14px;">
                <i class="material-icons" style="font-size: 14px;">arrow_back_ios</i>
            </button>
            <span style="white-space: nowrap;">Page {{page + 1}} of {{pagination.totalPage}}</span>
            <button (click)="changePage(page + 1)" [disabled]="page === pagination.totalPage - 1" style="padding: 2px 5px; font-size: 14px;">
                <i class="material-icons" style="font-size: 14px;">arrow_forward_ios</i>
            </button>
        </div>
    </div>
</div>
